<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Exercises — FitnessSphere</title>
<meta name="theme-color" content="#2ed3a8"/>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
<style>
:root{
  --mint-50:#edfff8; --mint-100:#d7ffef; --mint-200:#b9ffe3; --mint-300:#8ef7d1; --mint-400:#5ce7bd; --mint-500:#2ed3a8;
  --mint-600:#15b893; --mint-700:#10937a; --mint-800:#0c7361; --mint-900:#0a5b4e;
  --bg:#0b1220; --surf:#0f172a; --surf-2:rgba(15,23,42,.7);
  --text:#e6f6f0; --muted:#a7c3bb; --ring:var(--mint-400);
  --radius-xl:18px; --radius-2xl:26px;
  --shadow-1:0 8px 20px rgba(0,0,0,.25); --shadow-2:0 20px 40px rgba(0,0,0,.35);
  --ease:cubic-bezier(.2,.7,.2,1);
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; color:var(--text); font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;
  background:
    radial-gradient(1200px 600px at 0% -5%, rgba(46,211,168,.12), transparent 60%),
    radial-gradient(1000px 500px at 100% 0%, rgba(16,147,122,.12), transparent 60%),
    linear-gradient(180deg,#0a1220 0%,#09121d 100%);
  overflow-x:hidden;
}
a{text-decoration:none;color:var(--text)}
.btn{
  display:inline-flex;align-items:center;gap:.6rem;padding:.8rem 1rem;border-radius:999px;border:1px solid rgba(255,255,255,.08);
  background:linear-gradient(180deg,var(--mint-500),var(--mint-600));color:#06231d;font-weight:800;letter-spacing:.02em;
  box-shadow:inset 0 1px 0 rgba(255,255,255,.25),0 10px 20px rgba(46,211,168,.25);
  transition:transform .15s var(--ease),box-shadow .15s var(--ease),filter .15s var(--ease);cursor:pointer;
}
.btn:hover{transform:translateY(-2px);box-shadow:0 16px 28px rgba(46,211,168,.35)}
.btn--ghost{background:transparent;color:var(--text);border-color:#2b374a;box-shadow:none}
.btn--flat{background:rgba(255,255,255,.06);border-color:rgba(255,255,255,.08);color:var(--text)}
.badge{display:inline-block;padding:.25rem .6rem;border-radius:10px;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.12);font-weight:800;font-size:.75rem}
.chip{display:inline-flex;align-items:center;gap:.4rem;padding:.45rem .7rem;border-radius:999px;background:linear-gradient(180deg,var(--mint-200),var(--mint-300));color:#06382e;font-weight:800;font-size:.8rem}
.input, select, textarea{
  width:100%;padding:.8rem .9rem;border-radius:12px;background:rgba(255,255,255,.04);
  border:1px solid rgba(255,255,255,.08);color:var(--text);outline:none;transition:border-color .2s
}
.input:focus, select:focus, textarea:focus{border-color:var(--ring);box-shadow:0 0 0 3px rgba(46,211,168,.18)}

.container{width:min(1220px,94vw);margin:0 auto}
.nav{
  position:sticky;top:0;z-index:50;backdrop-filter:blur(14px);
  background:linear-gradient(180deg,rgba(15,23,42,.7),rgba(15,23,42,.35));border-bottom:1px solid rgba(255,255,255,.06)
}
.nav__in{display:flex;align-items:center;justify-content:space-between;padding:.6rem .8rem}
.brand{display:flex;align-items:center;gap:.7rem;font-weight:900;font-size:1.05rem}
.brand img{width:34px;height:34px;border-radius:10px;object-fit:cover;box-shadow:0 6px 18px rgba(46,211,168,.35)}
.nav__links{display:flex;gap:.6rem;align-items:center}
.nav__links a{padding:.5rem .65rem;border-radius:10px;color:var(--muted)}
.nav__links a.active,.nav__links a:hover{background:rgba(255,255,255,.06);color:var(--text)}
.hamburger{display:none;width:42px;height:42px;border-radius:12px;border:0;background:transparent;color:var(--text)}
@media(max-width:900px){.nav__links{display:none}.hamburger{display:inline-grid;place-items:center}.mobileMenu{position:fixed;inset:64px 12px auto 12px;display:none;padding:.8rem;border-radius:18px;background:rgba(15,23,42,.94);border:1px solid rgba(255,255,255,.08);box-shadow:var(--shadow-2)}.mobileMenu.open{display:block}.mobileMenu a{display:block;padding:.8rem;border-radius:12px}}

.header{padding: clamp(1.2rem,5vw,2.2rem) 0 .6rem}
.header h1{font-size: clamp(1.6rem,4vw,2.6rem); margin:.2rem 0 .5rem; letter-spacing:-.02em; font-weight:900}
.header p{color:var(--muted);max-width:70ch}

.grid{display:grid;gap:1rem}
@media(min-width:1000px){.grid-2{grid-template-columns:1.1fr .9fr}}

.card{
  background:linear-gradient(180deg,rgba(16,23,42,.65),rgba(16,23,42,.45)); border:1px solid rgba(255,255,255,.08);
  border-radius:var(--radius-2xl); padding:1rem; box-shadow:var(--shadow-1)
}
.card h3{margin:.2rem 0 .6rem}
.helper{color:var(--muted);font-size:.92rem}

.filters{display:grid;grid-template-columns:1fr 1fr;gap:.6rem}
@media(min-width:760px){.filters{grid-template-columns:repeat(4,1fr)}}
.pills{display:flex;gap:.45rem;flex-wrap:wrap}
.pill{
  padding:.45rem .6rem;border-radius:999px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.08);cursor:pointer;font-weight:700;font-size:.85rem;color:var(--text);
  transition:transform .12s var(--ease), background .12s var(--ease);
}
.pill:hover{transform:translateY(-1px)}
.pill.active{background:linear-gradient(180deg,var(--mint-400),var(--mint-600));color:#05261e;border-color:transparent}
.tools{display:flex;gap:.5rem;flex-wrap:wrap;margin-top:.6rem}

.results{display:grid;grid-template-columns:1fr;gap:.8rem;margin-top:.8rem}
@media(min-width:700px){.results{grid-template-columns:1fr 1fr}}
@media(min-width:1200px){.results{grid-template-columns:1fr 1fr}}
.card--exercise{display:grid;grid-template-columns:96px 1fr;gap:.8rem;align-items:center;position:relative;overflow:hidden}
.thumb{
  width:96px;height:96px;border-radius:16px;background:#0c1527;border:1px solid rgba(255,255,255,.08);
  display:grid;place-items:center;overflow:hidden;position:relative
}
.thumb img{width:100%;height:100%;object-fit:cover;display:block;transform:scale(1.02);transition:transform .3s}
.card--exercise:hover .thumb img{transform:scale(1.06)}
.ex-meta{display:flex;gap:.4rem;flex-wrap:wrap;margin-top:.2rem}
.ex-meta .badge{font-weight:800}
.ex-cta{display:flex;gap:.4rem;flex-wrap:wrap;margin-top:.6rem}
.kbd{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;font-size:.78rem;padding:.15rem .35rem;border-radius:6px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);}

.rightRail{position:sticky;top:78px;height:calc(100vh - 96px);overflow:auto}
.builder-item{display:grid;grid-template-columns:1fr auto auto auto auto;gap:.4rem;align-items:center;padding:.5rem;border-radius:12px;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.06)}
.builder-item input{width:70px}
.small{font-size:.9rem}
.hr{height:1px;background:rgba(255,255,255,.08);margin:.8rem 0}

.toast{
  position:fixed; bottom:16px; right:16px; background:rgba(15,23,42,.96); border:1px solid rgba(255,255,255,.12);
  padding:.8rem 1rem; border-radius:14px; display:none; box-shadow:var(--shadow-2); z-index:60
}
.toast.show{display:block;animation:fadeIn .25s ease}
@keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}

.skeleton{background:linear-gradient(90deg, rgba(255,255,255,.06), rgba(255,255,255,.12), rgba(255,255,255,.06));background-size:200% 100%;animation:sk 1.2s infinite}
@keyframes sk{0%{background-position:200% 0}100%{background-position:-200% 0}}

.timer{display:flex;align-items:center;gap:.6rem;flex-wrap:wrap}
.timer .time{font-size:2rem;font-weight:900;letter-spacing:.04em}
.progress{height:10px;background:#1e293b;border:1px solid rgba(255,255,255,.08);border-radius:999px;overflow:hidden}
.progress>span{display:block;height:100%;width:0%;background:linear-gradient(90deg,var(--mint-400),var(--mint-700));transition:width .25s var(--ease)}
.musclemap{display:grid;grid-template-columns:1fr 1fr;gap:.6rem}
svg{max-width:100%}
svg .hit{fill:rgba(46,211,168,.15);stroke:rgba(46,211,168,.45);stroke-width:1.5;cursor:pointer}
svg .hit.active{fill:rgba(46,211,168,.35)}
@media(prefers-reduced-motion:reduce){
  .btn,.progress>span,.thumb img{transition:none !important}
}
</style>
</head>
<body>
<!-- NAV -->
<header class="nav">
  <div class="container nav__in">
    <a class="brand" href="index.html">
      <img src="logo.png" alt="FitnessSphere logo">
      <span>FitnessSphere</span>
    </a>
    <nav class="nav__links">
      <a href="weight-loss.html">Weight Loss</a>
      <a href="weight-gain.html">Weight Gain</a>
      <a href="calories.html">Calories</a>
      <a href="exercises.html" class="active">Exercises</a>
      <a href="premium.html">Premium</a>
    </nav>
    <button class="hamburger" id="hamburger" aria-label="menu">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
    </button>
  </div>
  <div class="mobileMenu" id="mobileMenu">
    <a href="weight-loss.html">Weight Loss</a>
    <a href="weight-gain.html">Weight Gain</a>
    <a href="calories.html">Calories</a>
    <a href="exercises.html">Exercises</a>
    <a href="premium.html">Premium</a>
  </div>
</header>

<div class="container">
  <div class="header">
    <span class="chip">Massive library + Workout Builder</span>
    <h1>Exercise Explorer</h1>
    <p>Search, filter, and preview hundreds of exercises by muscle, equipment, and difficulty. Build workouts with sets, reps, and rest. Everything animates, saves locally, and exports.</p>
  </div>

  <div class="grid grid-2">
    <!-- LEFT: BROWSER -->
    <section class="card">
      <h3>Browse & filter</h3>

      <!-- MUSCLE MAP -->
      <div class="musclemap" style="margin:.6rem 0">
        <!-- Front -->
        <div class="card" style="padding:.6rem">
          <div class="small helper" style="margin:.2rem 0 .4rem">Tap muscles (front)</div>
          <svg viewBox="0 0 200 400" aria-label="Front muscle map">
            <!-- Simplified clickable areas -->
            <path id="chest" class="hit" d="M70,90 C70,60 130,60 130,90 130,120 70,120 70,90z"/>
            <path id="abs" class="hit" d="M85,120 h30 v70 h-30 z"/>
            <path id="quads" class="hit" d="M70,200 h25 v70 h-25 z M105,200 h25 v70 h-25 z"/>
            <path id="biceps" class="hit" d="M50,110 h15 v40 h-15 z M135,110 h15 v40 h-15 z"/>
            <path id="shoulders" class="hit" d="M60,80 h20 v15 h-20 z M120,80 h20 v15 h-20 z"/>
          </svg>
        </div>
        <!-- Back -->
        <div class="card" style="padding:.6rem">
          <div class="small helper" style="margin:.2rem 0 .4rem">Tap muscles (back)</div>
          <svg viewBox="0 0 200 400" aria-label="Back muscle map">
            <path id="back" class="hit" d="M70,90 C70,60 130,60 130,90 130,140 70,140 70,90z"/>
            <path id="triceps" class="hit" d="M50,110 h15 v40 h-15 z M135,110 h15 v40 h-15 z"/>
            <path id="glutes" class="hit" d="M70,160 h60 v30 h-60 z"/>
            <path id="hamstrings" class="hit" d="M70,200 h25 v70 h-25 z M105,200 h25 v70 h-25 z"/>
            <path id="calves" class="hit" d="M70,270 h25 v50 h-25 z M105,270 h25 v50 h-25 z"/>
          </svg>
        </div>
      </div>

      <div class="filters">
        <div>
          <label class="small">Search</label>
          <input id="q" class="input" placeholder="e.g., push-up, squat, plank"/>
        </div>
        <div>
          <label class="small">Primary muscle</label>
          <select id="muscle" class="input">
            <option value="">Any</option>
          </select>
        </div>
        <div>
          <label class="small">Equipment</label>
          <select id="equipment" class="input">
            <option value="">Any</option>
            <option>Bodyweight</option><option>Dumbbell</option><option>Barbell</option><option>Kettlebell</option>
            <option>Cable</option><option>Machine</option><option>Band</option><option>Medicine Ball</option><option>TRX</option><option>Bench</option>
          </select>
        </div>
        <div>
          <label class="small">Difficulty</label>
          <select id="level" class="input">
            <option value="">Any</option><option>Beginner</option><option>Intermediate</option><option>Advanced</option>
          </select>
        </div>
      </div>

      <div class="tools">
        <div class="pills" id="typePills" aria-label="Exercise types">
          <span class="pill active" data-type="">All</span>
          <span class="pill" data-type="Strength">Strength</span>
          <span class="pill" data-type="Cardio">Cardio</span>
          <span class="pill" data-type="Mobility">Mobility</span>
          <span class="pill" data-type="Stretch">Stretch</span>
          <span class="pill" data-type="Yoga">Yoga</span>
          <span class="pill" data-type="Olympic Weightlifting">Olympic</span>
          <span class="pill" data-type="Plyometrics">Plyo</span>
          <span class="pill" data-type="Strongman">Strongman</span>
        </div>
        <button class="btn btn--ghost" id="clearFilters">Clear filters</button>
        <button class="btn btn--ghost" id="loadMore">Load more</button>
      </div>

      <div class="hr"></div>
      <div class="helper">Tip: Click an exercise to see form cues. Press <span class="kbd">A</span> to add to builder, <span class="kbd">F</span> to favorite.</div>

      <div class="results" id="results" aria-live="polite" aria-busy="false"></div>
    </section>

    <!-- RIGHT: BUILDER / DETAILS -->
    <aside class="rightRail">
      <div class="card">
        <h3>Workout builder</h3>
        <div id="builder"></div>
        <div class="hr"></div>
        <div class="small helper">Add exercises, then choose sets/reps or time. Toggle superset to pair adjacent moves.</div>
        <div class="tools" style="margin-top:.6rem">
          <button class="btn" id="startWorkout">Start workout</button>
          <button class="btn btn--ghost" id="savePlan">Save</button>
          <button class="btn btn--ghost" id="exportPlan">Export</button>
          <button class="btn btn--ghost" id="clearPlan">Clear</button>
        </div>
      </div>

      <div class="card" style="margin-top:1rem">
        <h3>Timer</h3>
        <div class="timer">
          <span class="time" id="time">00:00</span>
          <div class="progress" style="flex:1"><span id="timeBar"></span></div>
        </div>
        <div class="tools" style="margin-top:.6rem">
          <input id="timerSec" class="input" type="number" min="5" step="5" value="60" />
          <button class="btn btn--flat" id="timerStart">Start</button>
          <button class="btn btn--ghost" id="timerPause">Pause</button>
          <button class="btn btn--ghost" id="timerReset">Reset</button>
        </div>
        <p class="helper small" style="margin-top:.4rem">Use as rest timer or intervals. Plays a beep at 0.</p>
      </div>

      <div class="card" style="margin-top:1rem">
        <h3>Favorites</h3>
        <div id="faves" class="results"></div>
      </div>
    </aside>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
/* ================== CONFIG (ADD KEYS IF YOU HAVE THEM) ================== */
/*
  The page will load a BIG local dataset so it works offline.
  If you add API keys, it will also fetch from live sources and merge results.

  Supported:
  - ExerciseDB (RapidAPI) — GIFs & 1000+ moves
    https://rapidapi.com/justin-WFnsXH_t6/api/exercisedb
  - API Ninjas (Exercises) — quick no-image text feed
    https://api-ninjas.com/api/exercises
  - WGER (free, no key) — sometimes CORS limited images
    https://wger.de/en/software/api
*/
const KEYS = {
  RAPID_EXERCISEDB_KEY: "",    // RapidAPI 'X-RapidAPI-Key'
  NINJAS_KEY: "",              // 'X-Api-Key' for api-ninjas
  // WGER needs no key but we use it conservatively
};

const STRATEGY = {
  useRapid: ()=> !!KEYS.RAPID_EXERCISEDB_KEY,
  useNinjas: ()=> !!KEYS.NINJAS_KEY
};

/* ================== UTILITIES ================== */
const $ = (s, r=document)=> r.querySelector(s);
const $$ = (s, r=document)=> Array.from(r.querySelectorAll(s));
const toast = (msg)=>{ const t=$("#toast"); t.textContent=msg; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'), 1800); };
const debounce = (fn, ms=250)=>{let t; return (...a)=>{clearTimeout(t); t=setTimeout(()=>fn(...a),ms);} };
const slug = s => s.toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'');

/* ================== DATA MODEL ================== */
// Exercise schema we use internally:
// { id, name, type, level, equipment, primaryMuscles[], secondaryMuscles[], instructions[], gif, source }
let DB = []; // master list (local + API)
let PAGE_SIZE = 24, page = 1;

let builder = []; // [{id, name, sets, reps, duration, rest, superset}]
let favorites = JSON.parse(localStorage.getItem('fs_faves')||"[]");
let savedPlan = JSON.parse(localStorage.getItem('fs_plan')||"[]");

/* ================== LOCAL DATASET (CURATED) ================== */
/* Compact seed (100+). You can extend this by appending more objects or import JSON. */
const LOCAL = [
  {id:"push-up",name:"Push-Up",type:"Strength",level:"Beginner",equipment:"Bodyweight",primary:["chest"],secondary:["triceps","shoulders"],gif:"",instructions:[
    "Hands under shoulders, body in straight line.",
    "Lower chest to just above floor, elbows ~45°.",
    "Drive through palms to full lockout."
  ]},
  {id:"squat-bw",name:"Bodyweight Squat",type:"Strength",level:"Beginner",equipment:"Bodyweight",primary:["quads","glutes"],secondary:["hamstrings","core"],gif:"",instructions:[
    "Feet shoulder-width, brace core.",
    "Hips back then down, knees track over toes.",
    "Drive up through midfoot; stand tall."
  ]},
  {id:"plank",name:"Plank",type:"Mobility",level:"Beginner",equipment:"Bodyweight",primary:["core"],secondary:["glutes","shoulders"],gif:"",instructions:[
    "Elbows under shoulders, body straight.",
    "Squeeze glutes, keep ribs down.",
    "Hold steady breathing."
  ]},
  {id:"deadlift-db",name:"Dumbbell Romanian Deadlift",type:"Strength",level:"Intermediate",equipment:"Dumbbell",primary:["hamstrings","glutes"],secondary:["back","core"],gif:"",instructions:[
    "Soft knees, hinge at hips keeping back neutral.",
    "Lower DBs to mid-shin, feel hamstrings load.",
    "Drive hips forward to stand tall."
  ]},
  {id:"row-barbell",name:"Barbell Bent-Over Row",type:"Strength",level:"Intermediate",equipment:"Barbell",primary:["back"],secondary:["biceps","rear delts","core"],gif:"",instructions:[
    "Hinge to ~45°, brace, neutral spine.",
    "Pull bar to lower ribs; elbows drive back.",
    "Lower under control without spinal movement."
  ]},
  {id:"ohp",name:"Overhead Press",type:"Strength",level:"Intermediate",equipment:"Barbell",primary:["shoulders"],secondary:["triceps","upper chest","core"],gif:"",instructions:[
    "Bar on front rack; glutes, quads tight.",
    "Press up and slightly back; head moves through.",
    "Lockout with ribs down, control down."
  ]},
  {id:"kb-swing",name:"Kettlebell Swing",type:"Plyometrics",level:"Intermediate",equipment:"Kettlebell",primary:["glutes","hamstrings"],secondary:["back","core"],gif:"",instructions:[
    "Hinge, hike bell; snap hips to swing to chest height.",
    "Arms are hooks; no shoulder raise.",
    "Let bell float; re-hinge and repeat."
  ]},
  {id:"burpee",name:"Burpee",type:"Cardio",level:"Intermediate",equipment:"Bodyweight",primary:["full body"],secondary:["cardio"],gif:"",instructions:[
    "Squat down, hands to floor; kick back to plank.",
    "Push-up optional; snap feet back in.",
    "Jump up with hands overhead."
  ]},
  {id:"lat-pulldown",name:"Lat Pulldown",type:"Strength",level:"Beginner",equipment:"Machine",primary:["back"],secondary:["biceps"],gif:"",instructions:[
    "Grip just outside shoulders.",
    "Pull bar to upper chest; drive elbows down.",
    "Control up; avoid shrugging."
  ]},
  {id:"face-pull",name:"Face Pull (Cable)",type:"Mobility",level:"Beginner",equipment:"Cable",primary:["rear delts"],secondary:["traps","rotator cuff"],gif:"",instructions:[
    "Rope at face height; thumbs back.",
    "Pull to nose; externally rotate.",
    "Squeeze 1–2s; control back."
  ]},
  {id:"hip-thrust",name:"Hip Thrust (Bench)",type:"Strength",level:"Beginner",equipment:"Bench",primary:["glutes"],secondary:["hamstrings","core"],gif:"",instructions:[
    "Upper back on bench, feet planted.",
    "Drive hips up; tuck pelvis, ribs down.",
    "Pause at top; control down."
  ]},
  {id:"calf-raise",name:"Standing Calf Raise",type:"Strength",level:"Beginner",equipment:"Bodyweight",primary:["calves"],secondary:[],gif:"",instructions:[
    "Stand tall, push through big toe.",
    "Full stretch then full peak contraction.",
    "Avoid bouncing."
  ]},
  {id:"hamstring-curl",name:"Hamstring Curl (Machine)",type:"Strength",level:"Beginner",equipment:"Machine",primary:["hamstrings"],secondary:[],gif:"",instructions:[
    "Align knees with machine pivot.",
    "Curl with hamstrings; avoid hips rising.",
    "Control eccentric."
  ]},
  {id:"treadmill",name:"Treadmill Run",type:"Cardio",level:"Beginner",equipment:"Machine",primary:["cardio"],secondary:["legs"],gif:"",instructions:[
    "Neutral posture; cadence steady.",
    "Short ground contact; relaxed arms.",
    "Breathe rhythmically."
  ]},
  {id:"side-plank",name:"Side Plank",type:"Mobility",level:"Beginner",equipment:"Bodyweight",primary:["obliques"],secondary:["glutes","shoulders"],gif:"",instructions:[
    "Elbow under shoulder, feet stacked.",
    "Lift hips; straight line head-to-feet.",
    "Hold; switch sides."
  ]},
  {id:"pull-up",name:"Pull-Up",type:"Strength",level:"Advanced",equipment:"Bodyweight",primary:["back"],secondary:["biceps"],gif:"",instructions:[
    "Full hang; pull chest to bar.",
    "Elbows down and back; ribs tucked.",
    "Lower to full extension."
  ]},
  {id:"pistol-squat",name:"Pistol Squat",type:"Strength",level:"Advanced",equipment:"Bodyweight",primary:["quads","glutes"],secondary:["core"],gif:"",instructions:[
    "Extend one leg forward; sit back on the other.",
    "Balance; keep knee tracking toes.",
    "Stand without collapsing knees."
  ]},
  // ... (You can append hundreds more; the UI and logic scales.)
];

// Popular muscles list / mapping to pills & map
const MUSCLES = ["chest","back","shoulders","biceps","triceps","forearms","core","abs","obliques","glutes","quads","hamstrings","calves","full body","cardio","rear delts","traps","upper chest"];

/* ================== INIT ================== */
const q=$("#q"), muscleSel=$("#muscle"), equipmentSel=$("#equipment"), levelSel=$("#level"), typePills=$("#typePills"), results=$("#results");
const builderRoot=$("#builder"), favesRoot=$("#faves");
const hamburger=$("#hamburger"), mobileMenu=$("#mobileMenu");

MUSCLES.forEach(m=>{
  const opt=document.createElement('option'); opt.value=m; opt.textContent=m[0].toUpperCase()+m.slice(1);
  muscleSel.append(opt);
});

// Mobile nav
hamburger?.addEventListener('click', ()=> mobileMenu.classList.toggle('open'));
document.addEventListener('click', (e)=>{ if(!mobileMenu.contains(e.target)&&!hamburger.contains(e.target)) mobileMenu.classList.remove('open'); });

// Type pills
typePills.addEventListener('click', (e)=>{
  const p = e.target.closest('.pill'); if(!p) return;
  $$('.pill', typePills).forEach(x=>x.classList.remove('active'));
  p.classList.add('active');
  render();
});

// Muscle map clicks map to selector
$$('svg .hit').forEach(hit=>{
  hit.addEventListener('click', ()=>{
    const id = hit.id;
    muscleSel.value = id === 'abs' ? 'abs' : id; // simple mapping
    $$('svg .hit').forEach(h=>h.classList.remove('active'));
    hit.classList.add('active');
    render();
  });
});

// Clear filters
$("#clearFilters").addEventListener('click', ()=>{
  q.value=""; muscleSel.value=""; equipmentSel.value=""; levelSel.value=""; 
  $$('.pill', typePills).forEach((x,i)=> x.classList.toggle('active', i===0));
  $$('svg .hit').forEach(h=>h.classList.remove('active'));
  page=1; render();
});

// Inputs
q.addEventListener('input', debounce(()=>{page=1; render();}, 200));
muscleSel.addEventListener('change', ()=>{page=1; render();});
equipmentSel.addEventListener('change', ()=>{page=1; render();});
levelSel.addEventListener('change', ()=>{page=1; render();});
$("#loadMore").addEventListener('click', ()=>{page++; render();});

// Builder controls
$("#clearPlan").addEventListener('click', ()=>{builder=[]; renderBuilder(); savePlan();});
$("#savePlan").addEventListener('click', ()=>{savePlan(); toast("Plan saved");});
$("#exportPlan").addEventListener('click', exportPlan);
$("#startWorkout").addEventListener('click', startWorkout);

// Timer controls
let timer=null, remaining=60, total=60, paused=false;
const timeEl=$("#time"), bar=$("#timeBar");
$("#timerStart").addEventListener('click', ()=>{
  total = remaining = Math.max(5, +$("#timerSec").value||60);
  runTimer();
});
$("#timerPause").addEventListener('click', ()=>{ paused = !paused; if(!paused) runTimer(); });
$("#timerReset").addEventListener('click', ()=>{ clearInterval(timer); timer=null; remaining = Math.max(5, +$("#timerSec").value||60); updateTime(); });

function runTimer(){
  clearInterval(timer);
  updateTime();
  timer = setInterval(()=>{
    if(paused) return;
    remaining--;
    if(remaining<=0){ remaining=0; updateTime(); clearInterval(timer); beep(); toast("Time!"); return; }
    updateTime();
  }, 1000);
}
function updateTime(){
  const mm = String(Math.floor(remaining/60)).padStart(2,'0');
  const ss = String(remaining%60).padStart(2,'0');
  timeEl.textContent = `${mm}:${ss}`;
  const pct = Math.max(0, Math.min(100, 100 - (remaining/Math.max(1,total))*100));
  bar.style.width = pct+"%";
}
function beep(){
  try{
    const ctx = new (window.AudioContext||window.webkitAudioContext)();
    const o = ctx.createOscillator(); const g = ctx.createGain();
    o.type='sine'; o.frequency.value=880; o.connect(g); g.connect(ctx.destination);
    o.start(); g.gain.setValueAtTime(0.001, ctx.currentTime); g.gain.exponentialRampToValueAtTime(.5, ctx.currentTime+.02);
    g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime+.25); o.stop(ctx.currentTime+.3);
  }catch(e){}
}

/* ================== FAVORITES ================== */
function isFav(id){ return favorites.includes(id); }
function toggleFav(id){
  const idx = favorites.indexOf(id);
  if(idx>=0) favorites.splice(idx,1); else favorites.unshift(id);
  favorites = Array.from(new Set(favorites)).slice(0,200);
  localStorage.setItem('fs_faves', JSON.stringify(favorites));
  render(); renderFaves();
}
function renderFaves(){
  if(favorites.length===0){ favesRoot.innerHTML = `<div class="helper small">No favorites yet. Press <span class="kbd">F</span> on a card.</div>`; return; }
  const list = DB.filter(x=> favorites.includes(x.id)).slice(0,50);
  favesRoot.innerHTML = list.map(cardHTML).join("");
  bindCardEvents(favesRoot);
}

/* ================== BUILDER ================== */
function addToBuilder(ex){
  const exists = builder.find(b=> b.id===ex.id);
  if(exists){ toast("Already in builder"); return; }
  builder.push({id:ex.id, name:ex.name, sets:3, reps:10, duration:0, rest:60, superset:false});
  renderBuilder(); savePlan(); toast("Added to builder");
}
function removeFromBuilder(id){ builder = builder.filter(b=> b.id!==id); renderBuilder(); savePlan(); }
function renderBuilder(){
  builderRoot.innerHTML = builder.length ? "" : `<div class="helper">No exercises yet.</div>`;
  builder.forEach(b=>{
    const row=document.createElement('div'); row.className="builder-item"; row.dataset.id=b.id;
    row.innerHTML = `
      <div><b>${b.name}</b></div>
      <div><input type="number" class="input sets" min="1" value="${b.sets}" title="Sets"></div>
      <div><input type="number" class="input reps" min="0" value="${b.reps}" title="Reps"></div>
      <div><input type="number" class="input duration" min="0" value="${b.duration}" title="Seconds"></div>
      <div style="display:flex;gap:.3rem">
        <button class="btn btn--flat sup">${b.superset?'Superset ✓':'Superset'}</button>
        <button class="btn btn--ghost del">✕</button>
      </div>
    `;
    builderRoot.append(row);
  });
  // bind
  $$('.builder-item').forEach(row=>{
    const id=row.dataset.id; const b=builder.find(x=>x.id===id);
    $('.sets',row).addEventListener('input', e=>{ b.sets=+e.target.value||1; savePlan(); });
    $('.reps',row).addEventListener('input', e=>{ b.reps=+e.target.value||0; savePlan(); });
    $('.duration',row).addEventListener('input', e=>{ b.duration=+e.target.value||0; savePlan(); });
    $('.del',row).addEventListener('click', ()=> removeFromBuilder(id));
    $('.sup',row).addEventListener('click', (e)=>{ b.superset=!b.superset; e.target.textContent=b.superset?'Superset ✓':'Superset'; savePlan(); });
  });
}
function savePlan(){ localStorage.setItem('fs_plan', JSON.stringify(builder)); }
function exportPlan(){
  const rows=[["Name","Sets","Reps","Duration(s)","Rest(s)","Superset"]];
  builder.forEach(b=> rows.push([b.name,b.sets,b.reps,b.duration,60,b.superset?'Yes':'No']));
  const csv = rows.map(r=> r.map(x=>`"${String(x).replace(/"/g,'""')}"`).join(",")).join("\n");
  const blob = new Blob([csv], {type:"text/csv"});
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = "fitnesssphere-workout.csv"; a.click();
}

/* ================== WORKOUT FLOW (SIMPLE) ================== */
function startWorkout(){
  if(builder.length===0){ toast("Add some moves first"); return; }
  let i=0, set=1;
  const next = ()=>{
    const b = builder[i];
    if(!b){ toast("Workout complete!"); return; }
    toast(`Next: ${b.name} — Set ${set}/${b.sets}${b.reps?` x${b.reps}`:''}${b.duration?` for ${b.duration}s`:''}`);
    // auto timer: duration or rest
    if(b.duration>0){ $("#timerSec").value=b.duration; $("#timerStart").click(); }
    else if(b.reps>0){ $("#timerSec").value=b.rest||60; $("#timerStart").click(); }
    // advance logic
    set++;
    if(set>b.sets){ set=1; i++; }
    // schedule prompt near end of rest
    setTimeout(()=>{ if(i<builder.length) toast(`Up next: ${builder[i].name}`); }, Math.max(0,(+$("#timerSec").value-5)*1000));
  };
  next();
}

/* ================== RENDER EXERCISES ================== */
function cardHTML(ex){
  const tags = [
    `<span class="badge">${ex.type||'Type'}</span>`,
    ex.level?`<span class="badge">${ex.level}</span>`:"",
    ex.equipment?`<span class="badge">${ex.equipment}</span>`:"",
    ex.primaryMuscles?.length?`<span class="badge">${ex.primaryMuscles.join(", ")}</span>`:"",
  ].filter(Boolean).join(" ");

  const fav = isFav(ex.id) ? "★" : "☆";
  const img = ex.gif ? `<img loading="lazy" src="${ex.gif}" alt="${ex.name} preview">` : `<div class="skeleton" style="width:100%;height:100%"></div>`;
  return `
  <div class="card card--exercise" data-id="${ex.id}">
    <div class="thumb">${img}</div>
    <div>
      <div style="display:flex;align-items:center;justify-content:space-between;gap:.5rem">
        <b>${ex.name}</b>
        <button class="btn btn--flat fav" title="Favorite">${fav}</button>
      </div>
      <div class="ex-meta">${tags}</div>
      <div class="ex-cta">
        <button class="btn add">Add</button>
        <button class="btn btn--ghost details">Details</button>
      </div>
    </div>
  </div>`;
}

function bindCardEvents(root=results){
  $$('.card--exercise', root).forEach(card=>{
    const id=card.dataset.id;
    const ex = DB.find(x=> x.id===id); if(!ex) return;
    $('.add',card).addEventListener('click', ()=> addToBuilder(ex));
    $('.details',card).addEventListener('click', ()=> showDetails(ex));
    $('.fav',card).addEventListener('click', (e)=>{ toggleFav(id); e.target.textContent=isFav(id)?"★":"☆"; });
    // shortcuts
    card.addEventListener('keydown', (e)=>{
      if(e.key.toLowerCase()==='a'){ addToBuilder(ex); }
      if(e.key.toLowerCase()==='f'){ toggleFav(id); $('.fav',card).textContent=isFav(id)?"★":"☆"; }
    });
    card.tabIndex = 0;
  });
}

function showDetails(ex){
  const lines = (ex.instructions||[]).map(s=> `• ${s}`).join('\n');
  const muscles = [...(ex.primaryMuscles||[]), ...(ex.secondaryMuscles||[])].join(', ') || '—';
  const info = `${ex.name}\n\nType: ${ex.type||'—'}   Level: ${ex.level||'—'}   Equipment: ${ex.equipment||'—'}\nMuscles: ${muscles}\n\nForm cues:\n${lines || '—'}`;
  alert(info);
}

function render(){
  const query=(q.value||"").toLowerCase().trim();
  const muscle=muscleSel.value;
  const equip=equipmentSel.value;
  const level=levelSel.value;
  const type=($('.pill.active', typePills)?.dataset.type)||"";

  const filtered = DB.filter(ex=>{
    const qok = !query || ex.name.toLowerCase().includes(query) || (ex.instructions||[]).join(" ").toLowerCase().includes(query);
    const mok = !muscle || (ex.primaryMuscles||[]).includes(muscle) || (ex.secondaryMuscles||[]).includes(muscle);
    const eok = !equip || (ex.equipment||"").toLowerCase()===equip.toLowerCase();
    const lok = !level || (ex.level||"").toLowerCase()===level.toLowerCase();
    const tok = !type || (ex.type||"").toLowerCase()===type.toLowerCase();
    return qok && mok && eok && lok && tok;
  });

  const count = PAGE_SIZE*page;
  const slice = filtered.slice(0, count);
  results.innerHTML = slice.length? slice.map(cardHTML).join("") : `<div class="helper">No matches. Try fewer filters.</div>`;
  bindCardEvents(results);
  $("#loadMore").style.display = filtered.length>slice.length ? "inline-flex":"none";
}

/* ================== MERGE SOURCES ================== */
function normalizeFromNinjas(n){
  return {
    id: slug(n.name+"-"+(n.equipment||"")+"-"+(n.difficulty||"")),
    name: title(n.name),
    type: title(n.type||"Strength"),
    level: title(n.difficulty||""),
    equipment: title(n.equipment||"Bodyweight"),
    primaryMuscles: (n.muscle||"").split(',').map(s=>s.trim()).filter(Boolean),
    secondaryMuscles: [],
    instructions: n.instructions ? n.instructions.split('. ').filter(Boolean) : [],
    gif: "", source:"ninjas"
  };
}
function normalizeFromExerciseDB(e){
  // ExerciseDB returns gifUrl and bodyPart/target equipment etc.
  return {
    id: e.id?.toString() || slug(e.name),
    name: title(e.name),
    type: "Strength",
    level: "", // not provided
    equipment: title(e.equipment||""),
    primaryMuscles: [e.target].filter(Boolean),
    secondaryMuscles: e.secondaryMuscles || [],
    instructions: [],
    gif: e.gifUrl || "",
    source:"exercisedb"
  };
}
function title(s){ return (s||"").split(' ').map(x=> x?x[0].toUpperCase()+x.slice(1):'').join(' '); }

/* ================== LOAD DATA ================== */
async function loadLocal(){
  // You can extend LOCAL by fetching a static JSON file too.
  DB = LOCAL.map(x=> ({
    id: x.id, name: x.name, type: x.type, level: x.level, equipment: x.equipment,
    primaryMuscles: (x.primary||x.primaryMuscles||[]), secondaryMuscles: (x.secondary||x.secondaryMuscles||[]),
    instructions: x.instructions||[], gif: x.gif||"", source:"local"
  }));
}

async function loadNinjas(){
  if(!STRATEGY.useNinjas()) return [];
  try{
    const res = await fetch("https://api.api-ninjas.com/v1/exercises?muscle=&type=&offset=0", {headers:{'X-Api-Key':KEYS.NINJAS_KEY}});
    const data = await res.json();
    return data.map(normalizeFromNinjas);
  }catch(e){ console.warn("ninjas failed", e); return []; }
}
async function loadExerciseDB(){
  if(!STRATEGY.useRapid()) return [];
  try{
    const res = await fetch("https://exercisedb.p.rapidapi.com/exercises?limit=1000", {
      headers:{'X-RapidAPI-Key': KEYS.RAPID_EXERCISEDB_KEY, 'X-RapidAPI-Host':'exercisedb.p.rapidapi.com'}
    });
    const data = await res.json();
    return data.map(normalizeFromExerciseDB);
  }catch(e){ console.warn("exerciseDB failed", e); return []; }
}

(async function boot(){
  await loadLocal();
  // Fetch APIs (if keys)
  const [nin, exdb] = await Promise.all([loadNinjas(), loadExerciseDB()]);
  // Merge uniques by id
  const byId = new Map();
  [...DB, ...nin, ...exdb].forEach(ex=> {
    if(!ex.id) ex.id = slug(ex.name+"-"+(ex.equipment||"")+"-"+(ex.source||""));
    const old = byId.get(ex.id);
    if(!old) byId.set(ex.id, ex);
    else { // prefer one with gif / more fields
      const merged = {...old, ...ex};
      if(ex.gif && !old.gif) merged.gif = ex.gif;
      if((ex.instructions||[]).length > (old.instructions||[]).length) merged.instructions = ex.instructions;
      if((ex.primaryMuscles||[]).length > (old.primaryMuscles||[]).length) merged.primaryMuscles = ex.primaryMuscles;
      byId.set(ex.id, merged);
    }
  });
  DB = Array.from(byId.values());
  // Seed from saved plan
  builder = savedPlan || [];
  renderBuilder(); render(); renderFaves();
})();

/* ================== KEYBOARD SHORTCUTS ================== */
document.addEventListener('keydown', (e)=>{
  if(e.key.toLowerCase()==='f' && document.activeElement?.classList?.contains('card--exercise')){
    const id=document.activeElement.dataset.id; toggleFav(id); renderFaves();
  }
  if(e.key.toLowerCase()==='a' && document.activeElement?.classList?.contains('card--exercise')){
    const id=document.activeElement.dataset.id; const ex = DB.find(x=>x.id===id); if(ex) addToBuilder(ex);
  }
});

/* ================== ACCESSIBILITY ================== */
document.addEventListener('keydown', (e)=>{ if(e.key==="Escape"){ mobileMenu.classList.remove('open'); }});
</script>
</body>
</html>
