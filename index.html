<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FitnessSphere — Home</title>
  <meta name="description" content="FitnessSphere — clean fitness resources, trackers, and plans. Mint-gradient premium design." />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

  <style>
  /* ======================================================================
     FitnessSphere — Index (Polished)
     Fixes applied:
     1) Removed underline from clickable elements
     2) Fixed sizing & prevented horizontal overflow
     3) Smooth, centered burger menu
     4) Working testimonials carousel
     5) Stronger mint gradients + matching accents
     6) More animations (reveal-on-scroll + microinteractions)
     ====================================================================== */

  :root{
    --bg-900:#071018;
    --bg-850:#08121b;
    --mint-200:#bff7ea;
    --mint-300:#86f4d0;
    --mint-400:#39e0b0;
    --mint-500:#10c08f;
    --teal-600:#0aa07a;
    --muted:#9fbfb0;
    --text:#e7fff6;
    --card:#0f172233;
    --glass: rgba(255,255,255,0.03);
    --radius:14px;
    --radius-lg:20px;
    --shadow-1: 0 8px 24px rgba(2,6,10,0.6);
    --shadow-2: 0 20px 40px rgba(2,6,10,0.75);
    --ease: cubic-bezier(.2,.9,.25,1);
    --speed: 420ms;
    --max-width:1120px;
  }

  *{box-sizing:border-box}
  html,body{height:100%; margin:0; padding:0; font-family:'Inter',system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; background:
    radial-gradient(900px 500px at 8% 10%, rgba(16,193,138,0.04), transparent 30%),
    linear-gradient(180deg,var(--bg-900),var(--bg-850));
    color:var(--text);
    scroll-behavior: smooth;
  }

  /* Prevent page horizontal tilt/overflow */
  body { overflow-x: hidden; }

  /* Remove underlines for anchors and clickable text-like elements,
     keep accessible focus via :focus-visible. */
  a, button { text-decoration: none; outline: none; -webkit-tap-highlight-color: transparent; }
  a { color: inherit; display: inline-block; }
  button { cursor: pointer; border: none; background: none; font: inherit; color: inherit; }

  .focus-ring:focus-visible { outline: 3px solid rgba(16,193,138,0.14); outline-offset: 4px; border-radius:8px; }

  /* ===== Utilities & layout ===== */
  .container{width:min(var(--max-width),94%); margin:0 auto}
  .row{display:flex; gap:16px; align-items:center; flex-wrap:wrap}
  .col{flex:1}
  .center{display:flex; align-items:center; justify-content:center}
  .sr-only{position:absolute!important; width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0 0 0 0);white-space:nowrap;border:0}

  /* ===== Header (STRICT: logo + name + burger) ===== */
  header.site-header{
    position:sticky; top:0; z-index:1200; backdrop-filter: blur(8px) saturate(120%);
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-bottom: 1px solid rgba(255,255,255,0.03);
  }
  .site-header .container{display:flex; align-items:center; justify-content:space-between; padding:12px 6px}
  .brand{display:flex; gap:12px; align-items:center; text-decoration:none}
  .brand img{height:42px; width:auto; display:block; filter: drop-shadow(0 6px 18px rgba(0,0,0,0.6))}
  .brand .site-name{font-weight:800; color:var(--mint-300); letter-spacing:0.2px; font-size:1.02rem}
  /* Burger (three-line only) */
  .burger{width:48px; height:48px; display:flex; align-items:center; justify-content:center; border-radius:12px; background:rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.03); transition: transform 160ms var(--ease)}
  .burger:active{transform:scale(.98)}
  .burger .lines{width:22px; height:16px; position:relative}
  .burger .lines span{position:absolute; left:0; right:0; height:2px; background:linear-gradient(90deg,var(--mint-300),var(--mint-500)); border-radius:2px; transition:transform 260ms var(--ease), opacity 240ms var(--ease)}
  .burger .lines span:nth-child(1){top:0} .burger .lines span:nth-child(2){top:7px} .burger .lines span:nth-child(3){top:14px}
  .burger.open .lines span:nth-child(1){transform:translateY(7px) rotate(45deg)}
  .burger.open .lines span:nth-child(2){opacity:0}
  .burger.open .lines span:nth-child(3){transform:translateY(-7px) rotate(-45deg)}

  /* ===== Fullscreen menu: centered + smooth (fixed) ===== */
  .fullmenu{position:fixed; inset:0; z-index:1300; display:none; align-items:center; justify-content:center; padding:28px; background: linear-gradient(180deg, rgba(3,7,10,0.9), rgba(3,7,10,0.94)); transition: opacity 280ms var(--ease), transform 320ms var(--ease)}
  .fullmenu.show{display:flex; opacity:1}
  .fullmenu.hidden{opacity:0}
  .menu-panel{width:min(720px,96%); border-radius:18px; padding:20px; background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border:1px solid rgba(255,255,255,0.03); box-shadow:var(--shadow-2); transform: translateY(-10px); transition: transform 320ms var(--ease), opacity 280ms var(--ease); }
  .fullmenu.show .menu-panel{transform: translateY(0)}

  .menu-list{display:grid; gap:8px}
  .menu-list a{display:block; padding:12px 14px; border-radius:12px; text-decoration:none; color:var(--mint-300); font-weight:700}
  .menu-list a:hover{background:rgba(16,193,138,0.03)}

  /* ensure menu is centered and not glitchy on small screens */
  @media (max-width:480px){
    .menu-panel{padding:14px}
  }

  /* ===== Hero ===== */
  .hero{padding:72px 0 40px; position:relative}
  .hero-inner{max-width:980px; margin:0 auto; text-align:center; padding:0 12px}
  .chip{
    display:inline-block; padding:9px 14px; border-radius:999px; font-weight:800; color:#05221b;
    background: linear-gradient(90deg,var(--mint-300),var(--mint-500)); box-shadow: 0 8px 30px rgba(16,193,138,0.12);
    transform-origin:center; animation:chipFloat 3200ms infinite ease-in-out;
  }
  @keyframes chipFloat{0%{transform:translateY(0)}50%{transform:translateY(-6px)}100%{transform:translateY(0)}}

  .hero h1{
    margin:18px 0 8px;
    font-weight:900;
    font-size: clamp(2rem, 6.5vw, 3.6rem);
    line-height:1.02;
    background: linear-gradient(180deg,var(--mint-300),var(--mint-500));
    -webkit-background-clip: text; color: transparent;
    filter: drop-shadow(0 12px 28px rgba(10,85,70,0.17));
    letter-spacing:-1px;
    opacity:0; transform:translateY(10px); transition: opacity 520ms var(--ease), transform 520ms var(--ease);
  }
  .hero h1.in-view{ opacity:1; transform:translateY(0); }

  .hero p.lead{ margin:0 auto; max-width:720px; color:var(--muted); font-weight:500; font-size:clamp(0.95rem,1.6vw,1.05rem); opacity:0; transform:translateY(8px); transition: opacity 520ms var(--ease) 120ms, transform 520ms var(--ease) 120ms }
  .hero p.lead.in-view{ opacity:1; transform:translateY(0) }

  .hero .cta-row{display:flex; gap:12px; justify-content:center; margin-top:20px; flex-wrap:wrap}
  .btn{padding:12px 18px; border-radius:12px; font-weight:800; display:inline-flex; align-items:center; justify-content:center; gap:8px; transition: transform 200ms var(--ease), box-shadow 200ms var(--ease}
  .btn.primary{background:linear-gradient(90deg,var(--mint-400),var(--mint-500)); color:#05221b; box-shadow:0 12px 30px rgba(16,193,138,0.12)}
  .btn.ghost{background:transparent; color:var(--mint-300); border:1px solid rgba(255,255,255,0.03)}
  .btn:active{transform:translateY(1px) scale(.997)}

  /* hero previews */
  .hero-previews{display:flex; gap:12px; justify-content:center; margin-top:26px; flex-wrap:wrap}
  .preview{
    width:220px; background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00)); padding:12px; border-radius:12px; border:1px solid rgba(255,255,255,0.03);
    box-shadow:var(--shadow-1); transition:transform 420ms var(--ease), box-shadow 420ms var(--ease), opacity 420ms var(--ease);
    opacity:0; transform: translateY(10px);
  }
  .preview.in-view{ opacity:1; transform: translateY(0) }
  .preview:hover{transform:translateY(-8px) rotate(-0.6deg); box-shadow:0 26px 50px rgba(0,0,0,0.55)}
  .preview h4{margin:0 0 6px; color:var(--mint-300)}
  .preview p{margin:0; color:var(--muted); font-size:0.92rem}

  /* Features grid */
  .features-grid{display:grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap:16px; align-items:start}
  .feature-card{
    background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
    border:1px solid rgba(255,255,255,0.03); padding:18px; border-radius:12px; transition:transform 360ms var(--ease), box-shadow 360ms var(--ease), opacity 420ms var(--ease);
    opacity:0; transform:translateY(12px);
  }
  .feature-card.in-view{ opacity:1; transform:translateY(0) }
  .feature-card:hover{transform:translateY(-8px); box-shadow:0 26px 48px rgba(0,0,0,0.55)}
  .feature-card h3{margin:0 0 8px; background: linear-gradient(90deg,var(--mint-300),var(--teal-600)); -webkit-background-clip:text; color:transparent}

  /* Testimonials carousel */
  .testimonial-track-wrapper{ overflow:hidden; position:relative; border-radius:12px }
  .testimonial-track{ display:flex; gap:12px; transition: transform 600ms var(--ease); will-change: transform; }
  .testimonial{ min-width:260px; padding:14px; border-radius:12px; border:1px solid rgba(255,255,255,0.03); background:linear-gradient(180deg, rgba(255,255,255,0.01),transparent); opacity:0; transform:translateY(8px); transition: opacity 520ms var(--ease), transform 520ms var(--ease) }
  .testimonial.in-view{ opacity:1; transform:translateY(0) }
  .testimonial h4{margin:0 0 8px; color:var(--mint-300)} .testimonial p{margin:0;color:var(--muted)}

  /* Contact form: ensure it never overflows (fix#2) */
  .contact-panel{ display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap }
  .contact-panel form{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; width:100%; }
  .contact-panel input[type="email"], .contact-panel input[type="text"] {
    padding:10px; border-radius:10px; border:1px solid rgba(255,255,255,0.03); background:transparent; color:var(--text);
    min-width:0; flex: 1 1 180px; /* prevents overflow by allowing shrink */
  }

  /* Footer */
  footer{padding:28px 0; border-top:1px solid rgba(255,255,255,0.02); margin-top:24px}
  .footer-grid{display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap}

  /* Responsive fixes to avoid tilt & overflow */
  @media (max-width:820px){
    .hero{padding:48px 0 26px}
    .hero .chip{padding:8px 12px}
    .brand img{height:36px}
    .preview{width:100%}
    .container{width:94%}
    .feature-card{padding:14px}
    .testimonial{min-width:220px}
  }

  /* subtle entrance for CTAs */
  .cta-animate { transform-origin:center; animation:ctaPop 1400ms cubic-bezier(.2,.9,.25,1) 600ms both; }
  @keyframes ctaPop { 0%{ transform: scale(.98); opacity:0 } 60%{ transform: scale(1.02); opacity:1 } 100%{ transform: scale(1); } }

  /* additional micro interactions utilities */
  .muted { color:var(--muted) }
  .mb-2 { margin-bottom:8px }
  .mt-2 { margin-top:8px }

  </style>
</head>
<body>

  <!-- HEADER -->
  <header class="site-header" role="banner" aria-label="Main header">
    <div class="container" style="display:flex;align-items:center;justify-content:space-between">
      <a class="brand" href="index.html" aria-label="FitnessSphere home">
        <img src="logo.png" alt="FitnessSphere logo" />
        <div class="site-name">FitnessSphere</div>
      </a>

      <!-- three-line menu only -->
      <button class="burger focus-ring" id="burger" aria-controls="mainMenu" aria-expanded="false" aria-label="Open menu">
        <div class="lines" aria-hidden="true"><span></span><span></span><span></span></div>
      </button>
    </div>
  </header>

  <!-- Fullscreen menu -->
  <div id="mainMenu" class="fullmenu" aria-hidden="true" role="dialog" aria-label="Main menu">
    <div class="menu-panel container" role="document" aria-modal="true">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px">
        <div style="display:flex;gap:12px;align-items:center">
          <img src="logo.png" alt="" style="height:34px">
          <div style="font-weight:800;color:var(--mint-300)">FitnessSphere</div>
        </div>
        <div>
          <button id="menuClose" class="btn ghost focus-ring" style="padding:8px 10px;border-radius:10px">Close</button>
        </div>
      </div>

      <nav class="menu-list" aria-label="Main navigation">
        <a href="index.html" class="focus-ring">Home</a>
        <a href="exercises.html" class="focus-ring">Exercises</a>
        <a href="calories.html" class="focus-ring">Calories</a>
        <a href="weight-gain.html" class="focus-ring">Weight Gain</a>
        <a href="weight-loss.html" class="focus-ring">Weight Loss</a>
        <a href="premium.html" class="focus-ring">Premium</a>
        <a href="#contact" class="focus-ring">Contact</a>
        <a href="#faq" class="focus-ring">FAQ</a>
      </nav>

      <hr style="border:none;border-top:1px solid rgba(255,255,255,0.03);margin:14px 0" />

      <div style="display:flex;gap:10px;align-items:center;justify-content:space-between">
        <div style="color:var(--muted)">Quick actions</div>
        <div style="display:flex;gap:8px">
          <button class="btn primary focus-ring" id="goTracker">Tracker</button>
          <button class="btn ghost focus-ring" id="goExercises">Exercises</button>
        </div>
      </div>
    </div>
  </div>

  <!-- HERO -->
  <main>
    <section class="hero" aria-labelledby="homeTitle">
      <div class="hero-inner container">
        <div class="chip" id="heroChip">Train Smart. Live Well.</div>

        <h1 id="homeTitle">Simple tools. Serious results.</h1>

        <p class="lead">FitnessSphere puts the essentials first — clear trackers, smart exercises, and custom plans. Use the cards below to open dedicated pages with full features.</p>

        <div class="cta-row">
          <a class="btn primary cta-animate focus-ring" href="calories.html" id="cta-calories">Open Calorie Tracker</a>
          <a class="btn ghost cta-animate focus-ring" href="exercises.html" id="cta-exercises">Browse Exercises</a>
        </div>

        <div class="hero-previews" role="region" aria-label="Quick previews">
          <a class="preview" href="calories.html" aria-label="Preview calorie tracker">
            <h4>Calories</h4>
            <p>Quick log preview — full tracker on the calories page with CSV export and progress analytics.</p>
            <div style="margin-top:10px; display:flex; gap:8px; align-items:center;">
              <div class="mini-ring" aria-hidden="true">
                <svg width="88" height="88" viewBox="0 0 120 120">
                  <circle cx="60" cy="60" r="50" stroke="rgba(255,255,255,0.04)" stroke-width="12" fill="none"></circle>
                  <circle class="ringA" cx="60" cy="60" r="50" stroke="url(#g1)" stroke-width="12" stroke-linecap="round" fill="none" stroke-dasharray="314" stroke-dashoffset="314"></circle>
                  <defs><linearGradient id="g1" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#86f4d0"/><stop offset="100%" stop-color="#10c08f"/></linearGradient></defs>
                </svg>
              </div>
              <div class="muted">Today • 1.2k kcal</div>
            </div>
          </a>

          <a class="preview" href="exercises.html" aria-label="Preview exercises">
            <h4>Exercises</h4>
            <p>Search & filter workouts. The exercises page contains demo animations and saved workouts.</p>
            <div style="margin-top:10px; display:flex; gap:8px; align-items:center;">
              <div style="width:40px;height:40px;border-radius:8px;background:linear-gradient(90deg,var(--mint-300),var(--mint-500));display:flex;align-items:center;justify-content:center;font-weight:800;color:#04221b">GO</div>
              <div class="muted">200+ exercises</div>
            </div>
          </a>

          <a class="preview" href="premium.html" aria-label="Preview premium">
            <h4>Premium</h4>
            <p>Advanced analytics, cloud sync, and export features — preview here, full set on Premium page.</p>
            <div style="margin-top:10px; display:flex; gap:8px; align-items:center;">
              <div style="width:40px;height:40px;border-radius:8px;background:linear-gradient(90deg,var(--mint-300),var(--teal-600));display:flex;align-items:center;justify-content:center;font-weight:800;color:#04221b">★</div>
              <div class="muted">Enhanced sync</div>
            </div>
          </a>
        </div>
      </div>
    </section>

    <!-- FEATURES -->
    <section class="features container" aria-labelledby="featuresTitle">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:12px">
        <div>
          <h2 id="featuresTitle" style="margin:0;color:var(--mint-300)">What FitnessSphere does</h2>
          <div style="color:var(--muted); margin-top:6px">Focused features — each has its own page for the full toolset.</div>
        </div>
        <div>
          <div style="color:var(--muted)">Tap a card to open the full tool</div>
        </div>
      </div>

      <div class="features-grid mt-4">
        <a class="feature-card focus-ring" href="calories.html" aria-label="Calories page">
          <h3>Calorie Tracker</h3>
          <p>Log meals quickly and view daily totals. Full tracker has CSV export, macros, and progress rings.</p>
        </a>

        <a class="feature-card focus-ring" href="exercises.html" aria-label="Exercises page">
          <h3>Exercise Library</h3>
          <p>Filter by muscle and difficulty, save favorites, and add to quick workouts. The exercises page has detailed demos.</p>
        </a>

        <a class="feature-card focus-ring" href="weight-loss.html" aria-label="Weight loss page">
          <h3>Weight Loss</h3>
          <p>Guided deficit plans, cardio templates, and meal ideas. The page includes multi-step programs.</p>
        </a>

        <a class="feature-card focus-ring" href="weight-gain.html" aria-label="Weight gain page">
          <h3>Weight Gain</h3>
          <p>Surplus strategies, protein-rich vegetarian meals, and strength templates to gain mass safely.</p>
        </a>

        <a class="feature-card focus-ring" href="premium.html" aria-label="Premium page">
          <h3>Premium</h3>
          <p>Cloud sync, advanced analytics, and export. Premium details and pricing are on the Premium page.</p>
        </a>

        <a class="feature-card focus-ring" href="#contact" aria-label="Contact and support">
          <h3>Support & Resources</h3>
          <p>Guides and FAQ pages. Vegetarian meal ideas and step-by-step support resources.</p>
        </a>
      </div>
    </section>

    <!-- Testimonials (WORKING carousel) -->
    <section class="container testimonials" aria-label="Testimonials">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:12px">
        <div>
          <h3 style="margin:0;color:var(--mint-300)">Loved by users</h3>
          <div style="color:var(--muted); margin-top:6px">Feedback from the community.</div>
        </div>
        <div style="color:var(--muted)">100k+ sessions</div>
      </div>

      <div style="margin-top:14px" class="testimonial-track-wrapper">
        <div id="testimonialTrack" class="testimonial-track" aria-live="polite">
          <div class="testimonial">
            <h4>"Clean & quick — exactly what I needed"</h4>
            <p class="mt-2">Saved me time and helped me track meals while studying. — Student, India</p>
          </div>
          <div class="testimonial">
            <h4>"Progress rings kept me consistent"</h4>
            <p class="mt-2">Small visual nudges every day make a difference. — Runner</p>
          </div>
          <div class="testimonial">
            <h4>"Premium analytics are worth it"</h4>
            <p class="mt-2">Exporting data and chart views are a game changer. — Coach</p>
          </div>
          <div class="testimonial">
            <h4>"Responsive & smooth UI"</h4>
            <p class="mt-2">The site works great on my phone and laptop. — Remote worker</p>
          </div>
        </div>
      </div>
    </section>

    <!-- CONTACT (fixed sizing so no overflow) -->
    <section id="contact" class="container" aria-labelledby="contactTitle" style="margin-top:18px">
      <div class="panel contact-panel" style="padding:16px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent); border:1px solid rgba(255,255,255,0.03)">
        <div style="flex:1; min-width:160px;">
          <h3 id="contactTitle" style="margin:0;color:var(--mint-300)">Get in touch</h3>
          <div style="color:var(--muted)">Bugs, suggestions, or collab ideas? Send a quick note.</div>
        </div>

        <form id="contactForm" style="display:flex; gap:8px; align-items:center; flex:1; min-width:0;">
          <!-- min-width:0 and flex: 1 prevents overflow (fix#2) -->
          <input id="contactEmail" type="email" placeholder="Email" required style="padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:var(--text); flex:1; min-width:0;">
          <input id="contactMsg" type="text" placeholder="Message" required style="padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:var(--text); flex:2; min-width:0;">
          <button class="btn primary focus-ring" type="submit">Send</button>
        </form>
      </div>
    </section>

  </main>

  <footer>
    <div class="container footer-grid" style="display:flex;align-items:center;justify-content:space-between">
      <div style="display:flex;gap:12px;align-items:center">
        <img src="logo.png" alt="" style="height:34px"/>
        <div style="color:var(--muted)">&copy; <span id="yr"></span> FitnessSphere</div>
      </div>
      <div style="display:flex;gap:12px;align-items:center">
        <a href="#privacy" class="muted focus-ring">Privacy</a>
        <a href="#terms" class="muted focus-ring">Terms</a>
      </div>
    </div>
  </footer>

  <!-- modal root -->
  <div id="modalRoot" style="position:fixed;inset:0;display:none;align-items:center;justify-content:center;z-index:1400;padding:18px">
    <div id="modalInner" style="background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:16px;border-radius:12px;min-width:280px;border:1px solid rgba(255,255,255,0.03)"></div>
  </div>

  <script>
  /* ===========================================================================
     JS: fixes & features
     - Smooth, centered menu with no glitches
     - No underlines anywhere; focus-visible ring for accessibility
     - Robust testimonial carousel
     - Reveal-on-scroll animations (IntersectionObserver)
     - Prevent horizontal overflow (contact inputs use min-width:0; body overflow-x hidden)
     - More mint gradient usage applied across UI via CSS
     =========================================================================== */

  (function(){
    const $ = s => document.querySelector(s);
    const $$ = s => Array.from(document.querySelectorAll(s));

    // Elements
    const burger = $('#burger');
    const mainMenu = $('#mainMenu');
    const menuClose = $('#menuClose');
    const goTracker = $('#goTracker');
    const goExercises = $('#goExercises');
    const yr = $('#yr');
    const testimonialTrack = $('#testimonialTrack');
    const testimonials = testimonialTrack ? Array.from(testimonialTrack.children) : [];
    const modalRoot = $('#modalRoot');
    const modalInner = $('#modalInner');

    // Year
    yr.textContent = new Date().getFullYear();

    // Menu open/close with smooth transitions
    function openMenu(){
      burger.classList.add('open');
      burger.setAttribute('aria-expanded','true');
      mainMenu.classList.add('show');
      mainMenu.classList.remove('hidden');
      mainMenu.style.display = 'flex';
      document.body.style.overflow = 'hidden'; // trap scroll
      // set focus to first link for keyboard users
      setTimeout(()=> {
        const firstLink = mainMenu.querySelector('a,button');
        if(firstLink) firstLink.focus();
      }, 200);
    }
    function closeMenu(){
      burger.classList.remove('open');
      burger.setAttribute('aria-expanded','false');
      mainMenu.classList.add('hidden');
      document.body.style.overflow = '';
      setTimeout(()=> {
        mainMenu.classList.remove('show');
        mainMenu.style.display = 'none';
      }, 300);
      // return focus to burger
      setTimeout(()=> burger.focus(), 300);
    }
    burger.addEventListener('click', ()=> { if(burger.classList.contains('open')) closeMenu(); else openMenu(); });
    menuClose?.addEventListener('click', closeMenu);
    mainMenu.addEventListener('click', (e)=> { if(e.target === mainMenu) closeMenu(); });

    // Close on Escape
    document.addEventListener('keydown', (e)=>{
      if(e.key === 'Escape') {
        closeMenu();
        closeModal();
      }
      if((e.ctrlKey||e.metaKey) && e.key.toLowerCase()==='k'){
        e.preventDefault();
        document.querySelector('.hero-previews a')?.focus();
      }
      if(e.key === '/') {
        // try focusing a search input if present on page
        e.preventDefault();
        document.querySelector('input[type="search"]')?.focus();
      }
    });

    // Quick nav buttons
    goTracker?.addEventListener('click', ()=>{ closeMenu(); location.href='calories.html'; });
    goExercises?.addEventListener('click', ()=>{ closeMenu(); location.href='exercises.html'; });

    // Reveal-on-scroll (applies to hero h1, lead, previews, feature cards, testimonials)
    const revealElements = Array.from(document.querySelectorAll('.hero h1, .hero p.lead, .preview, .feature-card, .testimonial'));
    const io = new IntersectionObserver((entries) => {
      entries.forEach(ent => {
        if(ent.isIntersecting){
          ent.target.classList.add('in-view');
        }
      });
    }, { root:null, threshold: 0.12 });
    revealElements.forEach(el => io.observe(el));

    // Testimonials carousel (robust)
    let tIndex = 0;
    let tTimer = null;
    function updateTestimonialTransform(index){
      // compute translateX by summing widths of previous items + gaps
      const gap = 12; // CSS gap
      let offset = 0;
      for(let i=0;i<index;i++){
        const r = testimonials[i].getBoundingClientRect();
        offset += Math.round(r.width) + gap;
      }
      testimonialTrack.style.transform = `translateX(-${offset}px)`;
    }
    function startTestimonials(){
      if(!testimonialTrack || testimonials.length <= 1) return;
      if(tTimer) clearInterval(tTimer);
      tTimer = setInterval(()=> {
        tIndex = (tIndex + 1) % testimonials.length;
        updateTestimonialTransform(tIndex);
      }, 4200);
    }
    // recalc on resize because widths change
    window.addEventListener('resize', () => {
      // ensure no overflow caused by carousel; clamp transform
      updateTestimonialTransform(tIndex);
    });
    // start after small delay to allow layout paint
    setTimeout(()=> {
      // mark testimonials as in-view to animate them on first paint
      testimonials.forEach((t,i)=> { setTimeout(()=> t.classList.add('in-view'), i*120);});
      startTestimonials();
    }, 600);

    // Modal helpers
    function openModal(html){
      modalInner.innerHTML = html;
      modalRoot.style.display = 'flex';
      setTimeout(()=> modalRoot.style.opacity = '1', 20);
      document.body.style.overflow = 'hidden';
    }
    function closeModal(){
      modalRoot.style.opacity = '0';
      setTimeout(()=> { modalRoot.style.display = 'none'; modalInner.innerHTML = ''; document.body.style.overflow = ''; }, 220);
    }
    modalRoot.addEventListener('click', function(e){
      if(e.target === modalRoot) closeModal();
    });

    // Contact form (keeps behavior lightweight)
    const contactForm = document.getElementById('contactForm');
    contactForm?.addEventListener('submit', function(e){
      e.preventDefault();
      const email = document.getElementById('contactEmail').value.trim();
      const msg = document.getElementById('contactMsg').value.trim();
      if(!email || !msg){ flash(contactForm); return alert('Enter an email and message'); }
      openModal(`<div style="padding:12px"><h3 style="margin:0;color:var(--mint-300)">Thanks!</h3><p style="color:var(--muted);margin-top:8px">Message received (demo). We'll reply to ${escapeHtml(email)}.</p><div style="margin-top:10px;text-align:right"><button id="closeM" class="btn primary">Close</button></div></div>`);
      document.getElementById('closeM').addEventListener('click', closeModal);
      contactForm.reset();
    });

    // small helpers
    function flash(el){ el.animate([{transform:'scale(1)'},{transform:'scale(1.02)'},{transform:'scale(1)'}],{duration:320, easing:'ease-in-out'}); }
    function escapeHtml(s){ return String(s).replace(/[&<>'"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[c])); }

    // Ensure hero text is visible if fonts are slow
    window.addEventListener('load', ()=> {
      setTimeout(()=> {
        document.querySelector('.hero h1')?.classList.add('in-view');
        document.querySelector('.hero p.lead')?.classList.add('in-view');
      }, 120);
    });

    // Accessibility: trap focus in menu while open
    mainMenu.addEventListener('keydown', function(e){
      if(e.key !== 'Tab') return;
      const focusables = Array.from(mainMenu.querySelectorAll('a,button,input,select,textarea')).filter(el => el.offsetParent !== null);
      if(!focusables.length) return;
      const first = focusables[0], last = focusables[focusables.length - 1];
      if(e.shiftKey && document.activeElement === first){ e.preventDefault(); last.focus(); }
      else if(!e.shiftKey && document.activeElement === last){ e.preventDefault(); first.focus(); }
    });

  })();
  </script>
</body>
</html>
